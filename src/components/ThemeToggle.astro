---
// ThemeToggle.astro - å¤©ä½“ã‚¯ãƒªãƒƒã‚¯å¼ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
import { css } from '@styles/css';

const celestialBodyStyles = css({
  position: 'fixed',
  bottom: '3rem', // ç”»é¢ä¸‹ã«é…ç½®
  left: '50%',
  transform: 'translateX(-50%)', // ä¸­å¤®ã«é…ç½®
  zIndex: 1000,
  width: '4rem',
  height: '4rem',
  borderRadius: '50%',
  border: 'none',
  cursor: 'pointer',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
  fontSize: '2rem',
  transition: 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
  filter: 'drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15))',
  
  // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ - ã‚µã‚¤ã‚ºã‚’å°ã•ãã€æ‰‹å‰ã«è¡¨ç¤º
  '@media (max-width: 768px)': {
    width: '2.8rem',
    height: '2.8rem',
    fontSize: '1.4rem',
    bottom: '2rem',
    zIndex: 1100,
  },
  
  // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
  _hover: {
    transform: 'translateX(-50%) scale(1.15)',
    filter: 'drop-shadow(0 6px 12px rgba(0, 0, 0, 0.2))',
  },
  
  _active: {
    transform: 'translateX(-50%) scale(1.05)',
  }
});

// å¤ªé™½ã®ã‚¹ã‚¿ã‚¤ãƒ«
const sunStyles = css({
  background: 'radial-gradient(circle, #ffeb3b 30%, #ff9800 100%)',
  boxShadow: `
    0 0 20px rgba(255, 152, 0, 0.4),
    0 0 40px rgba(255, 152, 0, 0.2),
    0 0 60px rgba(255, 152, 0, 0.1)
  `,
  
  _hover: {
    boxShadow: `
      0 0 25px rgba(255, 152, 0, 0.5),
      0 0 50px rgba(255, 152, 0, 0.3),
      0 0 75px rgba(255, 152, 0, 0.15)
    `,
  }
});

// æœˆã®ã‚¹ã‚¿ã‚¤ãƒ«
const moonStyles = css({
  background: 'radial-gradient(circle, #e8eaf6 30%, #9fa8da 100%)',
  boxShadow: `
    0 0 20px rgba(159, 168, 218, 0.4),
    0 0 40px rgba(159, 168, 218, 0.2),
    0 0 60px rgba(159, 168, 218, 0.1)
  `,
  
  _hover: {
    boxShadow: `
      0 0 25px rgba(159, 168, 218, 0.5),
      0 0 50px rgba(159, 168, 218, 0.3),
      0 0 75px rgba(159, 168, 218, 0.15)
    `,
  }
});
---

<div 
  class={`${celestialBodyStyles} ${sunStyles}`}
  id="sun-toggle"
  aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ"
  title="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ"
  style="display: block;"
>
  â˜€ï¸
</div>

<div 
  class={`${celestialBodyStyles} ${moonStyles}`}
  id="moon-toggle"
  aria-label="ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ"
  title="ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ"
  style="display: none;"
>
  ğŸŒ™
</div>

<script>
  // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®å‡¦ç†
  class ThemeToggle {
    private sunElement: HTMLDivElement;
    private moonElement: HTMLDivElement;
    private currentTheme: 'light' | 'dark';

    constructor() {
      this.sunElement = document.getElementById('sun-toggle') as HTMLDivElement;
      this.moonElement = document.getElementById('moon-toggle') as HTMLDivElement;
      this.currentTheme = this.getInitialTheme();
      
      this.init();
    }

    private getInitialTheme(): 'light' | 'dark' {
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’å–å¾—
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark' || savedTheme === 'light') {
        return savedTheme;
      }
      
      // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’ç¢ºèª
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark';
      }
      
      return 'light';
    }

    private init() {
      // åˆæœŸãƒ†ãƒ¼ãƒã‚’é©ç”¨
      this.applyTheme(this.currentTheme, false);
      
      // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
      this.sunElement.addEventListener('click', () => this.toggleTheme());
      this.moonElement.addEventListener('click', () => this.toggleTheme());
      
      // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®å¤‰æ›´ã‚’ç›£è¦–
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          this.currentTheme = e.matches ? 'dark' : 'light';
          this.applyTheme(this.currentTheme, true);
        }
      });
    }

    private toggleTheme() {
      this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
      this.applyTheme(this.currentTheme, true);
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      localStorage.setItem('theme', this.currentTheme);
    }

    private applyTheme(theme: 'light' | 'dark', animate: boolean) {
      const html = document.documentElement;
      
      if (theme === 'dark') {
        html.classList.add('dark');
      } else {
        html.classList.remove('dark');
      }
      
      if (animate) {
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§åˆ‡ã‚Šæ›¿ãˆ
        this.animateTransition();
      } else {
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã®å ´åˆã®ã¿å³åº§ã«è¡¨ç¤ºçŠ¶æ…‹ã‚’å¤‰æ›´
        if (theme === 'dark') {
          this.moonElement.style.display = 'flex';
          this.sunElement.style.display = 'none';
        } else {
          this.sunElement.style.display = 'flex';
          this.moonElement.style.display = 'none';
        }
      }
    }

    private animateTransition() {
      // å¤©ä½“ãƒœã‚¿ãƒ³è‡ªä½“ãŒç§»å‹•ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      this.animateCelestialBodies();
    }

    private animateCelestialBodies() {
      if (this.currentTheme === 'dark') {
        // ãƒ©ã‚¤ãƒˆâ†’ãƒ€ãƒ¼ã‚¯: å¤ªé™½ãŒå·¦ã«å»ã‚Šã€æœˆãŒå³ã‹ã‚‰æ¥ã‚‹
        this.animateLightToDark();
      } else {
        // ãƒ€ãƒ¼ã‚¯â†’ãƒ©ã‚¤ãƒˆ: æœˆãŒå·¦ã«å»ã‚Šã€å¤ªé™½ãŒå³ã‹ã‚‰æ¥ã‚‹
        this.animateDarkToLight();
      }
    }

    private animateLightToDark() {
      // å¤ªé™½ã‚’å¼§ã‚’æã„ã¦å³ä¸Šã«ç§»å‹•ï¼ˆå›è»¢è»¸: ç”»é¢ä¸­å¿ƒã‹ã‚‰ä¸‹ã«10vhï¼‰
      this.sunElement.style.transition = 'transform 1s ease-out';
      this.sunElement.style.transformOrigin = '50vw 60vh'; // ç”»é¢ä¸­å¿ƒã®ä¸‹ã‚’å›è»¢è»¸ã«
      this.sunElement.style.transform = 'translateX(-50%) rotate(180deg) scale(0.8)';
      
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«éè¡¨ç¤º
      setTimeout(() => {
        this.sunElement.style.display = 'none';
        this.sunElement.style.transform = '';
        this.sunElement.style.transformOrigin = '';
        this.sunElement.style.transition = '';
      }, 1000);
      
      // æœˆã‚’å·¦ã‹ã‚‰å¼§ã‚’æã„ã¦å‡ºç¾
      setTimeout(() => {
        this.moonElement.style.display = 'flex';
        this.moonElement.style.transformOrigin = '50vw 60vh';
        this.moonElement.style.transform = 'translateX(-50%) rotate(-180deg) scale(0.6)';
        this.moonElement.style.transition = 'none';
        
        requestAnimationFrame(() => {
          this.moonElement.style.transition = 'transform 1s ease-out';
          this.moonElement.style.transform = 'translateX(-50%) rotate(0deg) scale(1)';
        });
      }, 500);
      
      // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
      setTimeout(() => {
        this.moonElement.style.transform = '';
        this.moonElement.style.transformOrigin = '';
        this.moonElement.style.transition = '';
      }, 1600);
    }

    private animateDarkToLight() {
      // æœˆã‚’å¼§ã‚’æã„ã¦å³ä¸Šã«ç§»å‹•ï¼ˆå›è»¢è»¸: ç”»é¢ä¸­å¿ƒã‹ã‚‰ä¸‹ã«10vhï¼‰
      this.moonElement.style.transition = 'transform 1s ease-out';
      this.moonElement.style.transformOrigin = '50vw 60vh'; // ç”»é¢ä¸­å¿ƒã®ä¸‹ã‚’å›è»¢è»¸ã«
      this.moonElement.style.transform = 'translateX(-50%) rotate(180deg) scale(0.8)';
      
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«éè¡¨ç¤º
      setTimeout(() => {
        this.moonElement.style.display = 'none';
        this.moonElement.style.transform = '';
        this.moonElement.style.transformOrigin = '';
        this.moonElement.style.transition = '';
      }, 1000);
      
      // å¤ªé™½ã‚’å·¦ã‹ã‚‰å¼§ã‚’æã„ã¦å‡ºç¾
      setTimeout(() => {
        this.sunElement.style.display = 'flex';
        this.sunElement.style.transformOrigin = '50vw 60vh';
        this.sunElement.style.transform = 'translateX(-50%) rotate(-180deg) scale(0.6)';
        this.sunElement.style.transition = 'none';
        
        requestAnimationFrame(() => {
          this.sunElement.style.transition = 'transform 1s ease-out';
          this.sunElement.style.transform = 'translateX(-50%) rotate(0deg) scale(1)';
        });
      }, 500);
      
      // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
      setTimeout(() => {
        this.sunElement.style.transform = '';
        this.sunElement.style.transformOrigin = '';
        this.sunElement.style.transition = '';
      }, 1600);
    }


  }

  // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰åˆæœŸåŒ–
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => new ThemeToggle());
  } else {
    new ThemeToggle();
  }

  // View Transitions APIå¯¾å¿œï¼ˆãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®çŠ¶æ…‹ç¶­æŒï¼‰
  document.addEventListener('astro:page-load', () => {
    new ThemeToggle();
  });
</script>

<style>
  /* æ˜Ÿã®ãã‚‰ã‚ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆè»½é‡åŒ–ç‰ˆï¼‰ */
  @keyframes twinkle {
    0%, 100% { opacity: 0.05; }
    50% { opacity: 0.12; }
  }

  /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã®CSSå¤‰æ•° */
  :global(html.dark) {
    color-scheme: dark;
  }

  :global(html.dark body) {
    background: linear-gradient(135deg, #0f0f23, #1a1a2e);
    color: #e2e8f0;
  }

  :global(html:not(.dark) body) {
    background: linear-gradient(135deg, #fef9e7, #fff5d6);
    color: #1a1a1a;
  }

  /* ã‚ˆã‚Šæ»‘ã‚‰ã‹ã§è‡ªç„¶ãªèƒŒæ™¯è‰²ã®å¤‰åŒ– */
  :global(body) {
    transition: 
      background 2s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      color 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    position: relative;
    overflow-x: hidden;
  }

  /* å¤œç©ºã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ - ã‚ˆã‚Šæ·±ã¿ã®ã‚ã‚‹è‰²åˆã„ */
  :global(html.dark body) {
    background: 
      radial-gradient(ellipse at top, #1e3a8a 0%, transparent 50%),
      radial-gradient(ellipse at bottom, #0f172a 0%, transparent 50%),
      linear-gradient(180deg, #0c1445 0%, #1a1a2e 30%, #16213e 70%, #0f0f23 100%);
  }

  /* æ˜¼ç©ºã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ - ã‚ˆã‚Šæ¸©ã‹ã¿ã®ã‚ã‚‹è‰²åˆã„ */
  :global(html:not(.dark) body) {
    background: 
      radial-gradient(ellipse at top, #fef3c7 0%, transparent 50%),
      radial-gradient(ellipse at bottom, #ddd6fe 0%, transparent 50%),
      linear-gradient(180deg, #fef9e7 0%, #fff5d6 30%, #f0f8ff 70%, #e0f2fe 100%);
  }

  /* èƒŒæ™¯ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœã‚’è¿½åŠ  */
  :global(body::before) {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: -1;
    transition: opacity 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    opacity: 0;
  }

  /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®æ˜Ÿç©ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆè»½é‡åŒ–ç‰ˆï¼‰ */
  :global(html.dark body::before) {
    background: 
      radial-gradient(1px 1px at 25px 40px, #fff, transparent),
      radial-gradient(1px 1px at 80px 20px, #fff, transparent),
      radial-gradient(1px 1px at 150px 70px, #fff, transparent);
    background-repeat: repeat;
    background-size: 180px 90px;
    opacity: 0.08;
    animation: twinkle 6s linear infinite;
  }
</style>