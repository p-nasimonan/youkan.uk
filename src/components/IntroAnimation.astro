---
// IntroAnimation.astro - Â∞éÂÖ•„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
import { css } from '@styles/css';
import SelectionScreen from './SelectionScreen.astro';

export interface SelectionOption {
  id: string;
  title: string;
  description: string;
  backgroundImage: string;
  href: string;
}

interface Props {
  options: SelectionOption[];
}

const { options } = Astro.props;

// „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ë¶ÅÁ¥†„ÅÆ„Çπ„Çø„Ç§„É´
const introContainer = css({
  position: 'fixed',
  top: 0,
  left: 0,
  width: '100vw',
  height: '100vh',
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',
  justifyContent: 'center',
  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
  zIndex: 1000,
  opacity: 1,
  transition: 'opacity 1s ease-out',
  
  _dark: {
    background: 'linear-gradient(135deg, #1a202c 0%, #2d3748 100%)'
  }
});

const welcomeText = css({
  fontSize: '4xl',
  fontWeight: 'bold',
  color: 'white',
  textAlign: 'center',
  marginBottom: '2rem',
  opacity: 0,
  transform: 'translateY(30px)',
  animation: 'fadeInUp 1s ease-out 0.5s forwards',
  textShadow: '0 4px 8px rgba(0,0,0,0.3)',
  
  _dark: {
    color: '#f7fafc',
    textShadow: '0 4px 8px rgba(0,0,0,0.6)'
  }
});

const itemContainer = css({
  position: 'relative',
  width: '300px',
  height: '300px',
  margin: '0 auto'
});

// ‰∏≠ÂøÉ„Åã„ÇâÈ£õ„Å≥Âá∫„Åô„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Çπ„Çø„Ç§„É´
const floatingItem = css({
  position: 'absolute',
  fontSize: '4rem',
  opacity: 0,
  transform: 'scale(0) translate(-50%, -50%)',
  left: '50%',
  top: '50%',
  transformOrigin: 'center',
  filter: 'drop-shadow(0 4px 8px rgba(0,0,0,0.2))',
  
  '&.avatar': {
    animation: 'popOut 1.2s ease-out 1.8s forwards, float 3s ease-in-out 3s infinite'
  },
  '&.tea': {
    animation: 'popOut 1.2s ease-out 2.1s forwards, float 3s ease-in-out 3.3s infinite'
  },
  '&.youkan': {
    animation: 'popOut 1.2s ease-out 2.4s forwards, float 3s ease-in-out 3.6s infinite'
  }
});

const skipButton = css({
  position: 'fixed',
  bottom: '2rem',
  right: '2rem',
  padding: '0.75rem 1.5rem',
  backgroundColor: 'rgba(255,255,255,0.1)',
  backdropFilter: 'blur(10px)',
  border: '1px solid rgba(255,255,255,0.2)',
  borderRadius: '999px',
  color: 'white',
  fontSize: 'sm',
  fontWeight: 'medium',
  cursor: 'pointer',
  opacity: 0,
  animation: 'fadeIn 0.5s ease-out 1s forwards',
  transition: 'all 0.3s ease',
  
  _hover: {
    backgroundColor: 'rgba(255,255,255,0.2)',
    transform: 'scale(1.05)'
  },
  
  _dark: {
    backgroundColor: 'rgba(255,255,255,0.08)',
    border: '1px solid rgba(255,255,255,0.1)',
    _hover: {
      backgroundColor: 'rgba(255,255,255,0.15)'
    }
  }
});
---

<div id="intro-animation" class={introContainer}>
  <h1 class={welcomeText}>
    „Çà„ÅÜ„Åì„ÅùÔºÅ<br/>
    <span style="font-size: 0.8em; font-weight: normal;">„ÅÇ„Å™„Åü„ÅØ„Å©„ÅÆ„Çà„ÅÜ„Åã„Çì„Å´ËààÂë≥„Åå„ÅÇ„Çä„Åæ„Åô„ÅãÔºü</span>
  </h1>
  
  <div class={itemContainer}>
    <!-- „Ç¢„Éê„Çø„Éº -->
    <div class={`${floatingItem} avatar`} style="left: 20%; top: 30%;">
      üë§
    </div>
    
    <!-- Á¥ÖËå∂ -->
    <div class={`${floatingItem} tea`} style="left: 80%; top: 40%;">
      ü´ñ
    </div>
    
    <!-- „Çà„ÅÜ„Åã„Çì -->
    <div class={`${floatingItem} youkan`} style="left: 50%; top: 70%;">
      üç†
    </div>
  </div>
  
  <button id="skip-intro" class={skipButton}>
    „Çπ„Ç≠„ÉÉ„Éó
  </button>
</div>

<!-- „É°„Ç§„É≥„ÅÆÈÅ∏ÊäûÁîªÈù¢ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
<div id="selection-screen" style="opacity: 0; transform: translateY(100vh); transition: all 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);">
  <SelectionScreen options={options} />
</div>

<script>
  class IntroAnimationController {
    private introElement: HTMLElement;
    private selectionElement: HTMLElement;
    private skipButton: HTMLElement;
    private animationStarted = false;

    constructor() {
      this.introElement = document.getElementById('intro-animation')!;
      this.selectionElement = document.getElementById('selection-screen')!;
      this.skipButton = document.getElementById('skip-intro')!;
      
      this.init();
    }

    private init() {
      // „Çπ„Ç≠„ÉÉ„Éó„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
      this.skipButton.addEventListener('click', () => this.skipIntro());
      
      // Ëá™ÂãïÁöÑ„Å´„É°„Ç§„É≥ÁîªÈù¢„Å´ÈÅ∑ÁßªÔºà4ÁßíÂæåÔºâ
      setTimeout(() => {
        if (!this.animationStarted) {
          this.showMainScreen();
        }
      }, 4000);
    }

    private skipIntro() {
      this.showMainScreen();
    }

    private showMainScreen() {
      this.animationStarted = true;
      
      // Â∞éÂÖ•ÁîªÈù¢„Çí„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
      this.introElement.style.opacity = '0';
      this.introElement.style.transform = 'scale(0.95)';
      
      // ÈÅ∏ÊäûÁîªÈù¢„Çí‰∏ã„Åã„Çâ‰∏ä„Å´„Çπ„É©„Ç§„Éâ„Ç§„É≥
      setTimeout(() => {
        this.selectionElement.style.opacity = '1';
        this.selectionElement.style.transform = 'translateY(0)';
      }, 300);
      
      // Â∞éÂÖ•Ë¶ÅÁ¥†„ÇíÂÆåÂÖ®„Å´ÂâäÈô§
      setTimeout(() => {
        this.introElement.style.display = 'none';
      }, 1000);
    }
  }

  // DOM„ÅåË™≠„ÅøËæº„Åæ„Çå„Åü„ÇâÂàùÊúüÂåñ
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => new IntroAnimationController());
  } else {
    new IntroAnimationController();
  }

  // View Transitions APIÂØæÂøú
  document.addEventListener('astro:page-load', () => {
    new IntroAnimationController();
  });
</script>

<style>
  /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes fadeInUp {
    0% {
      opacity: 0;
      transform: translateY(30px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  @keyframes popOut {
    0% {
      opacity: 0;
      transform: scale(0) translate(-50%, -50%);
    }
    60% {
      opacity: 1;
      transform: scale(1.2) translate(-50%, -50%);
    }
    100% {
      opacity: 1;
      transform: scale(1) translate(-50%, -50%);
    }
  }

  @keyframes float {
    0%, 100% {
      transform: scale(1) translate(-50%, -50%);
    }
    50% {
      transform: scale(1) translate(-50%, -58%);
    }
  }

  /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
  @media (max-width: 768px) {
    .intro-container h1 {
      font-size: 2.5rem;
      margin-bottom: 1.5rem;
    }
    
    .floating-item {
      font-size: 3rem;
    }
    
    .item-container {
      width: 250px;
      height: 250px;
    }
  }
</style>